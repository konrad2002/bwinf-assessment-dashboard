<section class="dashboard" aria-labelledby="overview-title">
  <header class="header panel">
    <h1 id="overview-title">System Overview</h1>
    <nav aria-label="Quick stats" class="totals">
      @if (overallProgress()) {
        <span><b>Total submissions:</b> {{overallProgress()!.totalSubmissions}}</span>
        <span><b>Tasks:</b> {{overallProgress()!.totalTasks}}</span>
        <span><b>Assessed:</b> {{overallProgress()!.totalAssessmentsDone}}</span>
      }
    </nav>
  </header>

  <div class="grid">
    <section class="panel metrics" aria-label="Key metrics">
      @if (overallProgress()) {
        <div class="metric" role="group" aria-label="First assessments">
          <div class="metric__label">First assessments</div>
          <div class="metric__value">{{overallProgress()!.firstAssessmentsDone}}</div>
          <div class="metric__bar" aria-hidden="true">
            <div class="metric__bar-fill" [style.width.%]="overallProgress()!.percentages.first"></div>
          </div>
          <div class="sr-only">{{overallProgress()!.percentages.first | number:'1.0-2'}}% complete</div>
        </div>

        <div class="metric" role="group" aria-label="Second assessments">
          <div class="metric__label">Second assessments</div>
          <div class="metric__value">{{overallProgress()!.secondAssessmentsDone}}</div>
          <div class="metric__bar" aria-hidden="true">
            <div class="metric__bar-fill" [style.width.%]="overallProgress()!.percentages.second"></div>
          </div>
          <div class="sr-only">{{overallProgress()!.percentages.second | number:'1.0-2'}}% complete</div>
        </div>

        <div class="metric" role="group" aria-label="Total assessed">
          <div class="metric__label">Total assessed</div>
          <div class="metric__value">{{overallProgress()!.totalAssessmentsDone}}</div>
          <div class="metric__bar" aria-hidden="true">
            <div class="metric__bar-fill" [style.width.%]="overallProgress()!.percentages.total"></div>
          </div>
          <div class="sr-only">{{overallProgress()!.percentages.total | number:'1.0-2'}}% complete</div>
        </div>
      }
    </section>

    <section class="panel chart" aria-label="Overall completion">
      <apx-chart
        [series]="completionSeriesSignal()"
        [chart]="completionChartOptions.chart"
        [labels]="completionLabels"
        [title]="completionChartOptions.title"
        [legend]="completionChartOptions.legend">
      </apx-chart>
    </section>

    <section class="panel table" aria-label="Task submissions">
      <apx-chart
        [series]="submissionsSeriesSignal()"
        [chart]="submissionsChartOptions.chart"
        [xaxis]="{ categories: submissionsCategoriesSignal() }"
        [title]="submissionsChartOptions.title"
        [plotOptions]="submissionsChartOptions.plotOptions"
        [dataLabels]="submissionsChartOptions.dataLabels"
        [grid]="submissionsChartOptions.grid">
      </apx-chart>
    </section>

    <section class="panel list" aria-label="Tasks list">
      @if (taskProgress().length) {
        <ul>
          @for (task of taskProgress(); track task.taskId) {
            <li>
              <div class="task-row">
                <div class="task-name">{{getTaskName(task)}}</div>
                <div class="task-metrics">
                  <span title="Total submissions"><b>Σ</b> {{task.totalSubmissions}}</span>
                  <span title="Total done"><b>✓</b> {{task.totalAssessmentsDone}}</span>
                  <span title="Missing"><b>⧗</b> {{task.totalMissing}}</span>
                </div>
              </div>
            </li>
          }
        </ul>
      }
    </section>
  </div>
</section>
